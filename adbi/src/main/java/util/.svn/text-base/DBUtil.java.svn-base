package util;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.HashMap;
import java.util.Map;

public class DBUtil {
	private String jdbcDriverClassName = "org.gjt.mm.mysql.Driver";
//    private String jdbcConnectionUrl = "jdbc:mysql://192.168.110.29:3306/sohu_ad_pvinsight?useUnicode=true&characterEncoding=UTF-8";
	private String jdbcConnectionUrl = "jdbc:mysql://10.16.17.67:3306/sohu_ad_pvinsight?useUnicode=true&characterEncoding=UTF-8";
//	private String jdbcConnectionUrl = "jdbc:mysql://10.16.17.197:3306/sohu_ad_pvinsight?useUnicode=true&characterEncoding=UTF-8";
//	private String jdbcUsername = "root";
//	private String jdbcPassword = "1234";
	private String jdbcUsername = "adpv";
	private String jdbcPassword = "sohuadpv!(0#!";
	
//	public static void main(String[] args) {
//		DBUtil util = new DBUtil();
//		Map<String, Long> time_id_map = util.queryDB(" select time_id AS id, CONCAT(the_year, '-',the_month, " +
//				"'-', the_day, '-',the_hour) AS VALUE from sohu_time  ");
		
		
//		Map<String, Long> no_region_id_map = new HashMap<String, Long>();
//		if(no_region_id_map!=null
//				&&!no_region_id_map.isEmpty())
//		for (Iterator iterator = no_region_id_map.keySet().iterator(); iterator.hasNext();) {
//			String string = (String) iterator.next();
//		}
		
		
//		Map<String, Long> region_id_map = util
//		.queryDB(" select region_id AS id, CONCAT(province,'-',city "
//				+ ") AS VALUE from sohu_region ");
		
//		region_id_map.containsKey("CN41-CN4107");
		
//		Map<String, Long> time_id_map = util.queryDB(" select time_id AS id, CONCAT(the_year, '-',the_month, " +
//		"'-', the_day, '-',the_hour) AS VALUE from sohu_time  ");
//		
//		Map<String, Long> time_id_map = util.queryDB(" select time_id AS id, CONCAT(the_year, '-',the_month, " +
//		"'-', the_day, '-',the_hour) AS VALUE from sohu_time  ");		
//	}

	private String getConnectString(String ip, String port,String db){
		String res = "jdbc:mysql://" + ip + ":" + port + "/" + db + "?useUnicode=true&characterEncoding=UTF-8";
		return res;
	}
	
	public Connection getConnection() throws ClassNotFoundException,
			SQLException {
		Connection conn;
		Class.forName(jdbcDriverClassName);
		conn = DriverManager.getConnection(jdbcConnectionUrl, jdbcUsername,jdbcPassword);
		return conn;
	}
	
	public Connection getConnection(String ip, String port, String db,String user,String password) throws ClassNotFoundException,
	SQLException {
		jdbcConnectionUrl = getConnectString(ip,port,db);
		jdbcUsername = user;
		jdbcPassword = password;
		return getConnection();
		}
	
	public Map<String, Long> queryDB(String sql) throws ClassNotFoundException, SQLException{
		Connection conn = null;
		PreparedStatement stm = null;
		ResultSet rs = null;
		try {
			conn = getConnection();

			stm = (PreparedStatement) conn.prepareStatement(sql);
			rs = stm.executeQuery();
			Map<String, Long> map = new HashMap<String, Long>();
			while (rs.next()) {
				map.put(String.valueOf((rs.getString("VALUE").trim())), Long.valueOf((rs.getLong("id"))));
			}
			return map;
		} catch (ClassNotFoundException e) {
			throw e;
		} catch (SQLException e) {
			 throw e;
		} finally {
			close(conn, stm, rs);
		}
	}

	public static void close(Connection conn, PreparedStatement stm, ResultSet rs) {
		try {
			if (conn != null) {
				conn.close();
			}
			if ( stm!= null) {
				stm.close();
			}
			if (rs != null) {
				rs.close();
			}
		} catch (SQLException e) {
			System.out
					.println("Connection Close Error:--------------------------------");
			e.printStackTrace();
		}
	}
	
	public static void close(Connection conn, Statement stm, ResultSet rs) {
		try {
			if (conn != null) {
				conn.close();
			}
			if ( stm!= null) {
				stm.close();
			}
			if (rs != null) {
				rs.close();
			}
		} catch (SQLException e) {
			System.out
					.println("Connection Close Error:--------------------------------");
			e.printStackTrace();
		}
	}
}
